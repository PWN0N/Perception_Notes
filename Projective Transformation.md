
# Projective Transformation
---

## 一、相机位姿恢复
相机位姿指的是相机坐标系与世界坐标系的关系，也就是变换矩阵$M_{cw}$

---
### （一）旋转的恢复：
根据灭点解出世界坐标系各轴在相机坐标系下的方向


#### 简单情况：已知$x,y$轴方向，求$z$轴方向，通过观测一个灭点即可。

- $z$灭点：将世界坐标系$z$轴方向上的消影点称为$z$消影点。
    世界坐标：$z_\infty =\left[\begin{matrix}0,0,1,0\\\end{matrix}\right]^T$
    像素坐标：$v_z=[u,v,1]^T$
- 关系：$$Zv_z=K[r_1,r_2,r_3|t]z_\infty=K[r_3]z_\infty$$
    - 由外参矩阵只剩下$r_3$推出：相机平移或者绕$z$轴旋转时，相机光轴方向上的消影点在像素坐标系上的位置不变，只有绕$x,y$轴旋转时才会变。
    $$r_3=K^{-1}v_z||K^{-1}v_z||=\left[\begin{matrix}sin\alpha cos\beta\\sin\beta\\cos\alpha sin\beta\\\end{matrix}\right]$$
    - $\alpha,\beta$是世界坐标系$z$轴在相机坐标系下的方向（pan and tilt angles）
    $$\alpha=tan^{-1}{{r_3(1)}\over {r_3(3)}}$$$$\beta=cos^{-1}r_3(2)$$
#### 求三轴方向，观测两个消影点
- $z$消影点和$x$消影点

$$r_3=K^{-1}v_z$$$$r_1=K^{-1}v_x$$$$r_2=r_3\times r_1$$


## 投影变换的图形意义以及与灭点的关系

1. 投影变换将平面变换到平面，称作**共形**或**直射**
2. 表示从地面到像平面的投影变换，是一个三乘三的可逆矩阵，但是只有8个独立元素，用$ H $表示

> 如果知道一个点在地平面的坐标或在图像中的对应像素以及$H$，我们就可以在这两者间做变换

### 具有灭点的共形面之间的关系

> 透视投影的影响：当图像中存在灭点时，即本不相交的平行线在图中相交。

1. $ H = (h_1 h_2 h_3)$投影矩阵的第一列 $h_1$为$x$轴在地平面上的灭点，第二列$h_2$为$y$轴方向的灭点，头两列为正交灭点。
2.  地平线方程为：$$(h_1 \times h_2)^T \begin{pmatrix}  x \\ y \\ 1\end{pmatrix} = 0$$
3. 地面的法线：$(h_1 \times h_2)$  其意味着地面时如何倾斜的。

**总结：**投影变换包含了地平线的完整星系，也包含了地平线上的灭点。

## 交比（Cross Ratios）与单视点测量
### 交比的定义




1. 交比必须用四个点定义，一般可用双比值定义：$$CR(A,B,C,D)={AC \over AD} : {BC \over BD} $$
2. 交比在投影变换中保持不变 $${AC \over AD} : {BC \over BD}  = {AC^{’}\over AD^{’}} : {BC^{’} \over BD^{’} }$$ 可使用本性质进行单视点测量，即在点画面中测量距离
3. 利用交比进行单视点测量无需知道相机的位置以及固有变量（如相机的焦距）
4. 当一个点在无限远处——即在地平线上，如 $D$在无穷远点，那么有$$CR(A,B,C,D)={AC \over AD} : {BC \over BD}={AC \over BC} $$因为$$\lim_{D\to infinity}{AD \over BD} = 1 $$
5. 同样可以通过上式，无需平行线辅助来计算图像坐标系中灭点的位置

**总结：**
1.如果知道一个灭点，我们就可以计算出这个方向上的任何距离
2.同样可以在平行线中转移距离，前提是我们已知两个灭点
3.在计算的步骤中无需焦距或者其他固有变量（相机的位姿，像平面中心）。（可以在拍着情况位置的图片中使用这种方法）

## 双视点测量

不需要知道两个物体的相对位姿，测量非常简单的物体
